"use strict";var MatchList=function(n){function e(){return n.replace(/[*|#]/g,"").split("\n")}function t(n){return n.replace(/[a|e|i|o|u|\\]+/g,"")}function r(n){return t(n).length}function o(n){return n.match(/^[^aeiou].*/)}function i(n){return r(n)===c}function a(n,e){var t=function(n){var t=e||{},r=t.randomGenerator||Math.random;return Math.floor(r()*n)},r=function(n){var e={"a\\":"á","e\\":"é","i\\":"í","o\\":"ó","u\\":"ú"},t=n;for(var r in e)e.hasOwnProperty(r)&&(t=t.replace(r,e[r]));return t};this.fetch=function(){if(0==n.length)return null;var e=n[t(n.length-1)];return r(e)}}var c=2;return{all:function(){return e().filter(function(n){return i(n)&&o(n)})},match:function(n,e){var r=this.all().filter(function(e){return t(e)===n});return new a(r,e).fetch()}}},ConsonantsTable=function(){var n={0:"r",1:"t",2:"n",3:"m",4:"c",5:"l",6:"s",7:"j",8:"g",9:"b"};return{get:function(e){for(var t=e.toString(),r="",o=0;o<t.length;o++)r+=n[t.charAt(o)];return r}}},Mnemonic=function(n,e){var t,r=new XMLHttpRequest;return r.open("GET","/scripts/spanish.lex",!0),r.onreadystatechange=function(){4===r.readyState&&200===r.status&&(t=new e(r.responseText))},r.send(),function(r){return t=new e(r),{convert:function(e){var r=n.get(e);return t.match(r)}}}}(new ConsonantsTable,MatchList);!function(n){n.qs=function(n,e){return(e||document).querySelector(n)},n.qsa=function(n,e){return(e||document).querySelectorAll(n)},n.$on=function(n,e,t,r){return n?void n.addEventListener(e,t,!!r):void console.log("failed to add listener to element, target not found")}}(window);var Recorder=function(n,e){function t(n,e,t){navigator.mediaDevices.getUserMedia(n).then(e)["catch"](t)}function r(n){i=new MediaStreamRecorder(n),i.mimeType="audio/wav",i.ondataavailable=function(n){var e=URL.createObjectURL(n);document.write('<a href="'+e+'">'+e+"</a>")},i.start(3e3)}function o(n){console.error("media error",n)}var i,a={audio:!0};document.querySelector(n)&&(document.querySelector(n).onclick=function(){this.removeAttribute("disabled"),t(a,r,o)}),document.querySelector(e)&&(document.querySelector(e).onclick=function(){this.addAttribute("disabled"),i.stop(),i.stream.stop()})},FavoritesStorage=function(n){function e(n,e){return JSON.stringify({match:n,image:e})}var t=n||window.localStorage;return{save:function(n,r,o){t.setItem(n,e(r,o))},lookup:function(n){return JSON.parse(t.getItem(n))},remove:function(n){t.removeItem(n)}}},Favorites=function(n,e,t){function r(){[].slice.call(qsa("img.result")).forEach(function(n){$on(n,"click",o)})}function o(n){var e=!s(n.target);u(),e?(i(n.target.src),c(n.target)):a()}function i(r){e&&t&&n.save(d(),qs(t).innerHTML,r)}function a(){e&&n.remove(d())}function c(n){var e=n.parentNode;e.classList.add(l);var t=document.createElement("span");t.className=f+" glyphicon glyphicon-heart",e.appendChild(t)}function u(){[].slice.call(qsa("."+l)).forEach(function(n){n.classList.remove(l);var e=qs("."+f,n);n.removeChild(e)})}function s(n){return n.parentNode.classList.contains(l)}function d(){return qs(e).value}var l="selected-wrapper",f="fav-icon";r()},PageEvents=function(n){function e(n){var e=n.images,t=qs("#image-grid");e.forEach(function(n){var e=document.createElement("div");e.style.display="none",e.className="grid-item col-xs-4 col-md-4";var r=document.createElement("a");r.className="thumbnail";var o=document.createElement("img");o.className="img-responsive result",o.src=n,e.appendChild(r),r.appendChild(o),t.appendChild(e)}),r(),Favorites(u,"#numbers-input","#result-word")}function t(){(new c).show(),window.grid.remove(qsa(".grid-item")),window.grid.layout()}function r(){function e(e,t){var r=!!n(e).imagesLoaded;r?n(e).imagesLoaded(t):t()}e("#image-grid",function(){window.grid.appended(qsa(".grid-item")),n(".grid-item").show(),window.grid.layout(),(new c).hide()})}function o(n){var e=qs("#result-word");e&&(e.innerHTML=n)}function i(n){o(n),t()}function a(){var t=qs("#numbers-input").value;if(t){var r=window.mnemonic.convert(t);i(r),n.get("/search?q="+r,e)}}var c=function(){var n=function(){return document.createElement("div")},e=qs("#grid-spinner")||n();this.show=function(){e.style.display="block"},this.hide=function(){e.style.display="none"}};$on(qs("#numbers-input"),"blur",a),$on(qs("#search-button"),"click",a);var u=new FavoritesStorage;Recorder("#record-button","#stop-button")};!function(n,e,t){window.mnemonic=new Mnemonic,n(e),window.grid=new t("#image-grid",{itemSelector:".grid-item"})}(PageEvents,jQuery,Masonry);